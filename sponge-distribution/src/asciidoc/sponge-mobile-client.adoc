= Sponge Remote mobile client application
:page-permalink: /mobile/
:toc:
:appName: Sponge Remote

== Introduction
The {appName} is a https://flutter.io[Flutter] mobile application that provides a generic GUI to call remote {sponge} actions. It can be run on both Android and iOS. It could be used as _the one app to rule them all_ for {sponge} services that publish actions via the {sponge} REST API. All business logic has to be placed in {sponge} actions, so the only requirement to have the application working is to create your own {sponge} service by writing a knowledge base that define actions that will be visible and ready to run in the application or to connect to an existing {sponge} service.

NOTE: The application is currently under development and is not officially published. It will be released as an open source.

The {appName} is especially useful when data and functionality are more important than visual aspects of a GUI, e.g. for prototyping, rapid application development, low cost solutions, etc. The reason is that the application provides only a generic and opinionated GUI whose customization is limited.

image::mobile_architecture.svg[title="The mobile application architecture",width=800]

One of many use cases of the application is to connect to IoT devices that have {sponge} installed and execute available actions. Different types of such devices provide different sets of actions that are specific to a device features. For example one device could have a camera and provide an action to take a picture. Another device could have a temperature sensor and provide its readings or have a machine learning model and provide predictions.

The {appName} uses several {sponge} concepts such as actions and action arguments metadata, data types metadata, action and data type features, annotated values, provided action arguments, categories and events. It supports a convention over configuration paradigm.

You could build a customized GUI using your own Flutter code that will call the same {sponge} actions as the {appName}, using the upcoming {sponge} Flutter API library.

Unless noted otherwise in the release notes, the {appName} and the {sponge} Flutter API library versions `0.minor.*` are compatible only with the {sponge} service versions `1.minor.*`, e.g. the `0.16.5` version of the {appName} will be compatible with the `1.16.1` version of the {sponge} service.

NOTE: The {sponge} Flutter API library is currently under development and is not officially published. It will be released as an open source.

== Functionalities
The following chapters show the key functionalities of the mobile application.

=== Navigation

image::screens/mobile/drawer.png[title="The navigation drawer",width=300,pdfwidth=35%,scaledwidth=35%]

The navigation drawer allows switching between the main screens.

=== Connections

image::screens/mobile/actions_connection_list.png[title="Selecting a connection to the Sponge instance in the action list screen",width=300,pdfwidth=35%,scaledwidth=35%]

You may configure many connections to {sponge} REST API services. The application allows you to connect to a single service at the same time.

image::screens/mobile/connections.png[title="List of connections to Sponge instances",width=300,pdfwidth=35%,scaledwidth=35%]

You may add, edit and remove connections to {sponge} instances as well as activate a connection. To remove a connection swipe the corresponding element.

image::screens/mobile/connections_edit.png[title="Editing a connection to a Sponge instance",width=300,pdfwidth=35%,scaledwidth=35%]

A {sponge} address is the URL of the {sponge} instance.

The application can find nearby (i.e. located on the local network) {sponge} services.

=== Action list

image::screens/mobile/actions.png[title="The action list",width=300,pdfwidth=35%,scaledwidth=35%]

The main screen shows the list of actions defined in the connected {sponge} engine. Only actions that have argument and result metadata are available. This is because the application uses a generic access to the actions utilizing their data types, labels, descriptions, features and so on. The number in the action icon is the number of action arguments.

To call an action or set action attributes tap the triangular icon on the right side of the action label.

The floating button allows to refresh the action list from the server. The refresh button clears all entered action arguments and received results.

NOTE: The application currently doesn't supports all {sponge} data types.

=== Action call
When an action call screen is displayed, provided arguments will be fetched from the server. If an action call screen for the same action has been displayed earlier and a provided argument has been modified by a user, that argument will be fetched again only if it has the _overwrite_ flag.

An action call screen can be closed by swiping right.

image::screens/mobile/action_call_manage_lcd.png[title="The action call that manages the Raspberry Pi LCD display",width=300,pdfwidth=35%,scaledwidth=35%]

Actions may have read only, provided arguments to show data from the server (see the `Current LCD text` attribute). The `REFRESH` button retrieves the current values of such arguments manually.

.The definition of the action that manages the Raspberry Pi LCD display
[source,python]
----
include::{completeExamplesProject}/sponge-examples-project-iot-rpi/kb/sponge_iot_grovepi_manage_lcd.py[lines=5..-1]
----

image::screens/mobile/action_call_manage_sensors.png[title="The action call that manages the Grove Pi sensors and actuators",width=300,pdfwidth=35%,scaledwidth=35%]

The action call screen allows editing the action arguments.

.The definition of the action that manages the Grove Pi sensors and actuators
[source,python]
----
include::{completeExamplesProject}/sponge-examples-project-iot-rpi/kb/sponge_iot_grovepi_manage_sensors.py[lines=5..-1]
----

image::screens/mobile/action_call_send_sms.png[title="The action call that sends an SMS from the Raspberry Pi",width=300,pdfwidth=35%,scaledwidth=35%]

Actions arguments may be edited in multiline text fields.

.The definition of the action that sends an SMS from the Raspberry Pi
[source,python]
----
include::{completeExamplesProject}/sponge-examples-project-iot-rpi/kb/sponge_iot_sms.py[lines=5..-1]
----

image::screens/mobile/action_call_color.png[title="The action call argument editor for a color type",width=300,pdfwidth=35%,scaledwidth=35%]

The color picker widget allows a user to choose a color as an argument value.

.The definition of the action that takes a color argument
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_choose_color.py[lines=5..-1]
----

image::screens/mobile/action_call_digit_drawing.png[title="The action call argument editor for a digit drawing",width=300,pdfwidth=35%,scaledwidth=35%]

The drawing panel allows a user to paint an image that will be set as an argument value in an action call.

.The definition of the action that recognizes a handwritten digit
[source,python]
----
include::{rootDir}/sponge-tensorflow/examples/tensorflow/digits/actions/digits_predict.py[lines=5..-1]
----

image::screens/mobile/action_call_digit.png[title="The action call for an attribute of type drawing",width=300,pdfwidth=35%,scaledwidth=35%]

The action call screen shows all action arguments.

image::screens/mobile/action_call_digit_result.png[title="The action call result for a digit recognition",width=300,pdfwidth=35%,scaledwidth=35%]

If the action has been called, the result is shown below the action label. If the result can't be fully shown in the action list, you may tap the result to see the details.

image::screens/mobile/action_call_doodle_drawing.jpg[title="The action call argument editor for a doodle drawing",width=300,pdfwidth=35%,scaledwidth=35%]

Drawing panels can be configured in a corresponding action definition, where a color, a background color etc. could be specified.

.The definitions of actions that represent drawing and viewing a doodle
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_doodles.py[lines=5..-1]
----

image::screens/mobile/action_call_doodle.jpg[title="The action call for a doodle drawing as an argument",width=300,pdfwidth=35%,scaledwidth=35%]

The action call screen shows all action arguments, for example a drawing.

image::screens/mobile/action_call_arg_depends.png[title="The action call that shows argument dependencies",width=300,pdfwidth=35%,scaledwidth=35%]

Action arguments may depend on each other. Argument dependencies are supported in the action call panel and allow creating simple, interactive forms where some arguments are provided by the server, some entered by the user, some read only and some depend on the values of others. The important thing is that all that configuration is defined in an action in a knowledge base placed on the server side, not in the mobile application.

.The definition of the action that provides arguments with dependencies
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_depending.py[lines=5..-1]
----

image::screens/mobile/action_call_arg_depends_value_set.png[title="The action call that shows argument dependencies and value sets",width=300,pdfwidth=35%,scaledwidth=35%]

Allowed argument values can be defined in an action and provided from the server every time the action call screen is shown or an argument dependency value changes.

=== Action result

image::screens/mobile/actions_binary_result.png[title="The action binary result",width=300,pdfwidth=35%,scaledwidth=35%]

Actions may return contents that can be viewed for example as a HTML or a PDF file using the mobile OS viewers.

.The definitions of the actions that return a HTML and a PDF file respectively
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_binary_result.py[lines=5..-1]
----

image::screens/mobile/actions_console_result.png[title="The action console formatted result",width=300,pdfwidth=35%,scaledwidth=35%]

Actions may return a console output, for example the result of running the `df -h` command on the server.

.The definitions of the actions that returns OS commands output
[source,python]
----
include::{completeExamplesProject}/sponge-examples-project-iot-rpi/kb/sponge_iot_os.py[lines=5..-1]
----

image::screens/mobile/actions_markdown_result.png[title="The action Markdown formatted result",width=300,pdfwidth=35%,scaledwidth=35%]

Actions may return a https://en.wikipedia.org/wiki/Markdown[Markdown] formatted text.

=== Events
The {appName} can subscribe to {sponge} events. The subscription uses a {sponge} gRPC service published on a default port (i.e. the REST API port plus `1`). A user must have priviliges to subscribe to events and to send events.

There are a few places where {sponge} events are directly used in the application:

* An event list screen (handles events subscribed globally for the application).
* An action call screen for actions that have _refresh events_ configured (handles events subscribed locally for an action).

image::screens/mobile/actions_events.png[title="Event related actions",width=300,pdfwidth=35%,scaledwidth=35%]

==== Event subscription
Events can be subscribed globally for the application. Subscription management is performed by a subscription action, i.e. an action that has the `intent` feature set to `subscription`. {sponge} provides a default subscription action `GrpcApiManageSubscription`.

In case of a new event an operating system notification will be displayed.

image::screens/mobile/event_subscription_management.png[title="Event subscription management",width=300,pdfwidth=35%,scaledwidth=35%]

==== Event list
The event list screen shows all events the application has subscribed for but only those that has been sent when the application is running.

By tapping on an event the user will be directed to a screen presenting an action associated with this event. This action is called an _event handler action_ and is set up in the event type definition as a feature `handlerAction`. The action is required to have an `ObjectType` argument with object class `RemoteEvent`. An event instance will be passed to that argument. After the action is called, the event is automatically dismissed from the GUI.

If there is no event handler action defined for a specific event type, a default event handler action will be shown. The default action is searched by its `intent` feature which has to be `defaultEventHandler`. {sponge} provides a default event handler action `GrpcApiViewEvent`.

image::screens/mobile/event_list.png[title="Event list",width=300,pdfwidth=35%,scaledwidth=35%]

.Event type with a default event handler action
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_events_notification.py[lines=5..-1]
----

image::screens/mobile/event_handler_action_notification.png[title="Default event handler action",width=300,pdfwidth=35%,scaledwidth=35%]

.Event type with a custom event handler action
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_events_memo.py[lines=5..-1]
----

image::screens/mobile/event_handler_action_memo.png[title="Custom event handler action",width=300,pdfwidth=35%,scaledwidth=35%]

==== Action with refresh events
Every action can have _refresh events_ configured. When such an action is shown in the GUI, the application will subscribe to refresh events. When such event arrives, the action arguments will be automatically refreshed. Event arguments are ignored.

.Action with refresh events
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_events_counter_viewer.py[lines=5..-1]
----

image::screens/mobile/action_call_counter.png[title="Action with refresh events",width=300,pdfwidth=35%,scaledwidth=35%]

==== Sending events
Events can be sent by the application using an action. {sponge} provides a default, generic action for sending events `GrpcApiSendEvent`.

image::screens/mobile/event_send.png[title="Action that sends events",width=300,pdfwidth=35%,scaledwidth=35%]

[[mobile-advanced-use-cases]]
== Advanced use cases

=== Sub-actions
Sub-actions provide references to actions associated with a parent entity (e.g. a parent action, a record). A sub-action is represented by the `SubAction` class.

Sub-actions support argument and result substitutions.

.Sub-action properties
[cols="1,3"]
|===
|Property |Description

|`name`
|A sub-action name.

|`label`
|A sub-action label.

|`description`
|A sub-action description.

|`List<SubActionArg> args`
|Sub-action argument substitutions. An argument substitution is represented by the `SubActionArg` class. It can be added using the following methods: `withArgs(List<SubActionArg> args)`, `withArg(SubActionArg arg)` and `withArg(String target, String source)`.

|`SubActionResult result`
|A sub-action result substitution. A result substitution is represented by the `SubActionResult` class. It can be added using the following methods: `withResult(SubActionResult result)` and `withResult(String target)`.

|`Map<String, Object> features`
|Sub-action features.
|===

.Argument substitution properties
[cols="1,3"]
|===
|Property |Description

|`String target`
|A target attribute name (i.e. an argument name of a sub-action).

|`String source`
|A source attribute (i.e. an argument name of a parent entity).

|`Map<String, Object> features`
|Argument substitution features.
|===

.Result substitution properties
[cols="1,3"]
|===
|Property |Description

|`String target`
|A target attribute for the result (i.e. a nargument name of a parent entity).

|`Map<String, Object> features`
|Result substitution features.
|===


.Substitution keywords
[cols="1,2,4"]
|===
|Keyword |Substitution |Description

|`@this`
|argument source
|In case of a sub-action for an action it is a record of all parent action arguments. In case of a record argument or a list element it is the value itself.

|`@this`
|result target
|It represents all action arguments or a whole record value or a list element. If a sub-action returns `null` and the result substitution is `@this`, the result will be ignored.

|`@index`
|argument source
|A list element index. Applies only for lists.

|`@parent`
|argument source
|A whole list for a list element sub-actions. Applies only for lists.

|`@parent`
|result target
|A whole list for a list element sub-actions. Applies only for lists.
|===

==== Argument substitution
A target argument must have the same type as a source value. A source argument name could be a path if a source value is a record, e.g. `"arg1.field1"`.

If a sub-action has any visible arguments, a new action call screen will be shown.

The sub-action related features are not propagated to a sub-action in an annotated value feature.

Sub-actions can use globally saved (in a mobile application) action arguments but only if there is no argument substitutions (i.e. there are no arguments passed from the main action). It is necessary to avoid inconsistency.

==== Result substitution
A sub-action result can be assigned to a parent action argument.

=== Context actions
Context actions are sub-actions that can be specified for an action, a record and a list element (see the list-details). Context actions should be specified as the `contextActions` feature statically for a type or an action or dynamically for an annotated value. The latter option takes precedence.

image::screens/mobile/action_context_actions.png[title="The action with context actions",width=300,pdfwidth=35%,scaledwidth=35%]

.The definition of the action with context actions
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_context_actions_action.py[lines=5..-1]
----

==== Argument substitution
If a context value is an annotated value, the screen will show a header containing a label of the annotated value.

==== Active or inactive context actions
Before showing a list of context actions the application checks (by connecting to the server) if the context actions are active. Inactive actions will be greyed out.

=== List-details

image::screens/mobile/action_form_list_actions_list.png[title="The list-details action in the action list",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_main_action.png[title="The list-details main action screen",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_subactions.png[title="The CRUD and context actions",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_subaction_create.png[title="The create/add sub-action",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_subaction_read.png[title="The read/view sub-action",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_subaction_update.png[title="The update/modify sub-action",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_subaction_delete.png[title="The delete/remove sub-action",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_subaction_context_binary.png[title="The context action returning a binary result",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_subaction_context_args.png[title="The context action with an additional argument",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_form_list_details_subaction_context_args_result.png[title="The result of the context action with an additional argument",width=300,pdfwidth=35%,scaledwidth=35%]

.The definitions of actions implementing the list-details
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_forms_library_records.py[lines=5..-1]
----

The main action should have a list argument that is provided with the overwrite option. The action shouldn't be callable. The list argument type can be annotated and the provided list elements may have labels (`AnnotatedValue().withLabel()`) and descriptions. The list argument may have the following features: `createAction`, `readAction`, `updateAction`, `deleteAction`. Their values are the sub-action names that will be called to perform the CRUD operations.

There are two types of sub-actions: CRUD actions and context actions. CRUD actions implement _create_, _read_, _update_ and _delete_ operations. Context actions implement customized operations related to a list element.

The CRUD actions should not be visible in the actions list so they should have the `visible` feature set to `False`.

In the default scenario _read_, _update_ and _delete_ actions should have the first argument corresponding to the value of the list element. In most cases the argument `visible` feature should be set to `False` to hide it. Its type should be the same as the list element's type. The value of the list element will be passed as this argument. In the case of a _create_ action, no argument corresponding to any list element is necessary.

The result of a _create_, an _update_ and a _delete_ action is ignored and should be set to `withNoResult`.

After calling a CRUD action the main action arguments are refreshed.

A _create_ CRUD action has some limitations. It doesn't support argument substitutions and checking if the _create_ action is inactive.

=== Interactive form
An interactive form provides live update in a GUI and an instant modifications of a server state. It can be implemented by an action with provided and submittable arguments and action refresh events. Interactive forms can be used for example to manage IoT devices.

The following example shows a very simple MPD player implemented as a {sponge} action. A change in an MPD server state generates a {sponge} event. Such event is subscribed by the action in the mobile application and causes the action to refresh its arguments. On the other hand, a change made by a user in the GUI will cause such argument to be submitted to the server.

.Interactive form example
[source,python]
----
include::{rootDir}/sponge-kb/sponge-kb-mpd-mpc/src/main/resources/sponge/mpd-mpc/mpd_mpc_player.py[lines=5..-1]
----

image::screens/mobile/action_mpd_player_main.png[title="The MPD player action",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_mpd_player_context_actions.png[title="The context actions",width=300,pdfwidth=35%,scaledwidth=35%]

=== Geographical map
`ListType` elements can be shown on a geographical map if its list type has the `geoMap` feature configured.

Each list element that has the `geoPosition` feature will be displayed on the map. You can tap on an icon that represents an element to see the element label and its context actions.

If an action has only one argument which is a list with a geo map and the action has no buttons, the map will be displayed in a full action call screen. If a list with a geo map is an argument in an action that doesn't meet that criteria, the action call screen will display only a button for this argument. If the button is tapped a map screen will be shown.

If a list element has the `geoLayerName` feature that corresponds to a configured marker layer name, it will be assigned to that layer. If there is no marker layer configured, a default one with the `null` name will be created.

NOTE: The map functionality is experimental.

.Geographical map example
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_geo_map.py[lines=5..-1]
----

image::screens/mobile/action_call_geo_map_overview.png[title="The map overview",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_call_geo_map_menu.png[title="The main map menu",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_call_geo_map_no_clusters.png[title="The map with expanded clusters",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_call_geo_map_badges.png[title="The map with element badges",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_call_geo_map_context_actions.png[title="The element context actions menu",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_call_geo_map_context_action_call.png[title="The element context action call",width=300,pdfwidth=35%,scaledwidth=35%]

=== Choose dialog
A choose dialog can be used to pick a value and pass it as a result to a parent action argument.

.Choose dialog example
[source,python]
----
include::{rootDir}/sponge-app/sponge-app-demo-service/sponge/sponge_demo_setter_context_actions_list.py[lines=5..-1]
----

image::screens/mobile/action_call_choose_dialog_parent.png[title="The choose dialog parent action",width=300,pdfwidth=35%,scaledwidth=35%]

image::screens/mobile/action_call_choose_dialog.png[title="The choose dialog action",width=300,pdfwidth=35%,scaledwidth=35%]

== Settings

image::screens/mobile/settings.png[title="The application settings",width=300,pdfwidth=35%,scaledwidth=35%]

== User experience

image::screens/mobile/light_theme.png[title="The application light theme",width=300,pdfwidth=35%,scaledwidth=35%]

The application may be switched to the dark or the light theme in the settings.

== Supported {sponge} concepts

=== Data types

=== `AnyType`
Not supported.

=== `BinaryType`
Partially supported.

Editing (as an action attribute) is supported only for a `image/png` mime type with the `drawing` characteristic feature. Viewing is supported for image formats supported by Flutter and other binary content supported by the https://pub.dartlang.org/packages/open_file[`open_file` Flutter plugin] that is used by the application.

Support for nullable values is limited.

=== `BooleanType`
Supported.

=== `DateTimeType`
Partially supported.

`DATE_TIME_ZONE` and `INSTANT` editing is not supported.

The default format for `DATE` is `"yyyy-dd-MM"`. A format for `TIME` is required for the {sponge} REST API Dart client.

=== `DynamicType`
Partially supported. This functionality is considered experimental.

A new dynamic value can be created only on the server side, i.e. in an `onProvideArgs` action callback method. A provided `DynamicValue.type` name will be ignored because a name of a parent dynamic type is used in the application.

=== `IntegerType`
Supported.

=== `ListType`
Partially supported. This functionality is considered experimental.

A unique list with a provided element value set is represented as a multichoice widget. In most cases a complex list element should be annotated with a value label in order to be nicely displayed in the mobile GUI.

See the <<mobile-advanced-use-cases,Advanced use cases>> chapter.

Support for nullable values is limited.

=== `MapType`
Partially supported. This functionality is considered experimental.

Editing is not supported.

=== `NumberType`
Supported.

=== `ObjectType`
Partially supported. This functionality is considered experimental.

Supported only if an object type defines a companion type that is supported.

=== `RecordType`
Supported. This functionality is considered experimental.

=== `StreamType`
Not supported.

=== `StringType`
Supported.

A `StringType` value in a text field is always trimmed when the field is submitted and converted to `null` if it is empty. So for example you can't enter only white spaces in such text field if the type is not nullable.

=== `TypeType`
Not supported.

=== `VoidType`
Supported.

A https://material.io/components/chips/[`chip`] widget is presented as an editor. A user can tap the chip widget to submit an argument if it is configured as submittable.

=== Data type formats

.Supported data type formats
[cols="1,3"]
|===
|Format |Description

|`phone`
|A phone number format. Applicable for `StringType`.

|`email`
|An email format. Applicable for `StringType`.

|`url`
|A URL format. Applicable for `StringType`.

|`console`
|A console format. Text is presented using a monospaced font. Applicable for `StringType`.

|`markdown`
|A https://en.wikipedia.org/wiki/Markdown[Markdown] format. Applicable for `StringType`.
|===

=== Provided action arguments
A non-limited value set is supported only for `StringType`.

=== Features

.Supported features
[cols="1,1,1,3"]
|===
|Feature |Type |Applies to |Description

|`visible`
|`boolean`
|Action
|If `True`, an action will be visible in the main list of actions in the application. Defaults to `true`.

|`visible`
|`boolean`
|Type
|If `True`, an action argument or a record field is visible in the action call screen. Defaults to `true`.

|`visible`
|`boolean`
|`GeoLayer`
|If `True`, a map layer will be initially visible on a map. Defaults to `true`.

|`enabled`
|`boolean`
|Type
|If `True`, an action argument or a record field is enabled for editing. Defaults to `true`.

|`refreshable`
|`boolean`
|`ListType`
|If `True`, a provided list will have a button to refresh (i.e. provide arguments from the server). Defaults to `false`.

|`icon`
|`IconInfo` or `String`
|Action
|An action icon. The icon feature converter supports an instance of `IconInfo` or `String` (an icon name) as a value. The supported set of icon names is limited to the https://cdn.materialdesignicons.com/5.1.45/[material design icons (currently v5.1.45)].

|`icon`
|`IconInfo` or `String`
|Type
|A type icon. Currently supported only for list elements.

|`icon`
|`IconInfo` or `String`
|`GeoMarkerLayer`
|A map marker layer icon. Shows a layer marker on a map as a specified icon.

|`widget`
|`String`
|Type
|A GUI widget type. See the table below for supported values. Support for this feature is limited. In most cases a default, opinionated widget will be used.

|`group`
|`String`
|Type
|A name of a group of action arguments or record fields. Grouped values will be placed in a compact GUI panel close to each other, if it is possible.

|`group`
|`String`
|`GeoLayer`
|Map layers that have the same `group` will be grouped and only one of them will be visible at the same time.

|`key`
|`String`
|Action argument type
|A name of other argument whose value will be used as a key (or a key fragment) of a GUI widget. For example it enables saving a scroll position in a list. This feature is experimental and is currently implemented only for pageable lists.

|`responsive`
|`boolean`
|Type
|A responsive GUI widget. If this feature is set for a provided type, every change in GUI will cause invoking a `provideActionArgs` operation. This feature may be resource consuming (especially when used with an _argument submit_ option) because of possible many server roundtrips.

|`confirmation`
|`boolean`
|Action
|If `True` then before calling the action a confirmation dialog will be shown. Defaults to `false`.

|`characteristic`
|`String`
|Type
|A value of this feature indicates a special meaning of the type.

|`filename`
|`String`
|`BinaryType`
|A filename associated with a binary value.

|`intent`
|`String`
|Action
|An action with an intent is handled by the application in a specific way.

|`intent`
|`String`
|Type
|A type with an intent is handled by the application in a specific way.

|`refreshEvents`
|`List<String>`
|Action
|Refresh event names for an action.

|`handlerAction`
|`String`
|Event type
|An event handler action name.

|`multiline`
|`boolean`
|`StringType`
|If `True`, a string will be multilined in the GUI. Defaults to `false`.

|`maxLines`
|`int`
|`StringType`
|A maximum number of lines in the GUI.

|`obscure`
|`boolean`
|`StringType`
|If `True`, a string will be obscured in the GUI, e.g. in case of passwords. Defaults to `false`.

|`showCall`
|`boolean`
|Action
|An action call button will be shown in the action call screen. Defaults to `true`.

|`showRefresh`
|`boolean`
|Action
|An action arguments refresh button will be shown in the action call screen. Defaults to `false`. The refresh button fetches provided action arguments from the server. Only arguments provided with read only or overwrite flags will be refreshed.

|`showClear`
|`boolean`
|Action
|An action arguments clear button will be shown in the action call screen. Defaults to `false`. The clear button resets the action argument values.

|`showCancel`
|`boolean`
|Action
|A cancel button will be shown in the action call screen. Defaults to `false`.

|`callLabel`
|`String`
|Action
|An action call button label in the action call screen. Defaults to `RUN` if the feature is not set. If set to `None`, the button will not be shown.

|`refreshLabel`
|`String`
|Action
|An action refresh button label in the action call screen. Defaults to `REFRESH` if the feature is not set. If set to `None`, the button will not be shown.

|`clearLabel`
|`String`
|Action
|An action clear button label in the action call screen. Defaults to `CLEAR` if the feature is not set. If set to `None`, the button will not be shown.

|`cancelLabel`
|`String`
|Action
|An action cancel button label in the action call screen. Defaults to `CANCEL` if the feature is not set. If set to `None`, the button will not be shown.

|`contextActions`
|`List<SubAction>`
|Action, `RecordType`, `ListType` action argument
|Context actions. For more information on context actions and sub-actions see the <<mobile-advanced-use-cases,Advanced use cases>> chapter.

|`cacheableArgs`
|`boolean`
|Action
|A flag indicating that the action argument values can be cached (i.e. preserved between this action call screens) in a client. Defaults to `true`.

|`cacheableContextArgs`
|`boolean`
|Action
|A flag indicating that argument values of the action that is used as a _context action_ can be cached (i.e. preserved between this action call screens) in a client. Defaults to `false`. If set to `true` the `cacheableArgs` should be `true` as well.

|`createAction`
|`SubAction`
|`ListType` action argument
|A _create_ sub-action for a list element.

|`readAction`
|`SubAction`
|`ListType` action argument
|A _read_ sub-action for a list element.

|`updateAction`
|`SubAction`
|`ListType` action argument
|A _update_ sub-action for a list element.

|`deleteAction`
|`SubAction`
|`ListType` action argument
|A _delete_ sub-action for a list element.

|`activateAction`
|`SubAction`
|`ListType` action argument
|An action that will be called on list element tap. If the action name has the special value `@submit`, then instead of calling an action, a `provideActionArgs` will be invoked with the submitted list element.

|`width`
|`int`
|`BinaryType` drawing
|An image width.

|`height`
|`int`
|`BinaryType` drawing
|An image height.

|`strokeWidth`
|_number_
|`BinaryType` drawing
|A drawing stroke width.

|`background`
|`String`
|`BinaryType` drawing
|A drawing background color.

|`color`
|`String`
|`BinaryType` drawing
|A drawing pen color.

|`color`
|`String`
|`GeoMap`
|A map background color.

|`opacity`
|`boolean`
|`GeoTileLayer`, `GeoWmsLayer`
|A map tile layer opacity as a double value between 0 and 1.

|`scroll`
|`boolean`
|`ListType`
|A flag indicating that a list will have its own scroll. This feature turns off the main scroll in an action screen. It is useful for long lists. This feature is only supported for main action arguments (i.e. not nested). Defaults to `false`.

|`geoMap`
|`GeoMap`
|`ListType`
|Shows list elements in a geographical map. List elements should be of an annotated type and should contain geo position annotations. Supports https://en.wikipedia.org/wiki/Tiled_web_map[XYZ tiling] schemes as basemaps for list data. A `ListType` that has this feature should not be pageable.

|`tms`
|`boolean`
|`GeoTileLayer`
|A flag that informs if a tile layer service is https://en.wikipedia.org/wiki/Tile_Map_Service[TMS]. Defaults to `false`.
|===

Colors are represented by a hexadecimal value specified with `RRGGBB` (Red, Green, Blue), e.g. `"FF0000"`.

A _number_ can be an integer or a floating point value.

==== Intents

.Supported values for the `intent` feature
[cols="1,1,5"]
|===
|Intent |Applies to |Description

|`login`
|Action
|Should be set in an action that represents a user _login_ in the user management functionality. See {sourcesUrl}/sponge-examples-projects/sponge-examples-project-user-management[the user management example project].

|`logout`
|Action
|Should be set in an action that represents a user _logout_ in the user management functionality. User logout is equivalent to setting a connection to anonymous.

|`signUp`
|Action
|Should be set in an action that implements a user _sign up_ in the user management functionality.

|`subscription`
|Action
|Should be set in an action that manages event subscriptions.

|`defaultEventHandler`
|Action
|A default event handler action.

|`reload`
|Action
|Should be set in an action that reloads knowledge bases. Refreshes actions cached in a mobile application.

|`reset`
|Action
|Refreshes actions cached in a mobile application after an action call.

|`username`
|Action argument type
|Indicates that the action argument represents a username. Applies only to actions that implement the user management functionality. This intent may be omitted if an action argument name is `username`.

|`password`
|Action argument type
|Indicates that the action argument represents a password. Applies only to actions that implement the user management functionality. This intent may be omitted if an action argument name is `password`.

|`eventNames`
|Action argument type
|Indicates that the action argument represents event names to subscribe. Applies only to event subscription actions.

|`subscribe`
|Action argument type
|Indicates that the action argument represents a flag telling if to turn on or off an event subscribtion. Applies only to event subscription actions.
|===

==== Characteristic

.Supported values for the `characteristic` feature
[cols="1,1,5"]
|===
|Characteristic |Applies to |Description

|`drawing`
|`BinaryType`
|A `BinaryType` that represents a drawing. Currently supported only for the `image/png` mime type.

|`color`
|`StringType`
|A `StringType` that represents a color as a hexadecimal RGB string.

|`networkImage`
|`StringType`
|A `StringType` that represents a network image URL.
|===

==== Widgets

.Supported widget types for the `widget` feature
[cols="1,5"]
|===
|Widget |Description

|`slider`
|Supported for an `IntegerType` but only if it has min and max values defined. The default behaviour of a slider is lazy, i.e. a value is set on an end of drag. If an integer type has a `responsive` feature set to `true`, the value will be set while dragging.

|`switch`
|Supported for a `BooleanType`. The default widget for `BooleanType` is a checkbox.
|===

A data type property can be dynamically overwritten by a corresponding feature in an `AnnotatedValue`. The feature name has to be exactly the same as the data type property name. The overwrite is handled by the {appName}.

==== List pagination

.List pagination features
[cols="1,1,1,3"]
|===
|Feature |Type |Applies to |Description

|`pageable`
|`boolean`
|`ListType`
|If `True`, a list will be pageable. Defaults to `false`. A pageable list type has to be annotated, because values of offset, limit and count are passed by features in an annotated list value. A pageable list is assumed to have the `scroll` feature set to `true`.

|`offset`
|`int`
|`ListType` annotated value
|An offset of the first element of a page.

|`limit`
|`int`
|`ListType` annotated value
|A limit of a page, i.e. a maximum number of elements in a page.

|`count`
|`int`
|`ListType` annotated value
|A count of all available elements of a list. This value is optional.

|`indicatedIndex`
|`int`
|`ListType` annotated value
|An optional index of a single indicated element in a list. This feature is experimental and is implemented only for pageable lists with a limited functionality. If an element is indicated, the GUI will show a button enabling a user to jump to that element (but only if a page containing such element is already loaded from the server). Another limitation is that a jump resets a saved scroll position of a list. To use this feature in the application, you have to turn the application setting "_Use scrollable indexed list_" on.
|===

A pagination uses the `provideActionArgs` REST API operation. The features `offset` and `limit` have to be set when invoking `provideActionArgs`. A provided, annotated list must have the `offset` and the `limit` set and optionally the `count`. A client code is responsible for setting `offset` and `limit`. An action `onProvideArgs` callback method is not required to support `offset` or `limit` if they are not set in the request. A page size is established by a client code.

The pagination is supported only for primary (i.e. not nested) action arguments and only for read provided annotated lists.

The pagination works only _forward_, i.e. all previous list elements fetched from the server are stored in mobile device memory.

==== Geographical map
A geographical map feature is represented by the `GeoMap` class that contains layers as instances of `GeoLayer`:

* `GeoTileLayer` represents a tile layer,
* `GeoWmsLayer` represents a WMS layer,
* `GeoMarkerLayer` represents a marker layer,

A geographical position is represented by `GeoPosition`.

.Map (`GeoMap`) properties
[cols="1,1,3"]
|===
|Property |Type |Description

|`center`
|`GeoPosition`
|A map center.

|`zoom`
|`Double`
|A map zoom.

|`minZoom`
|`Double`
|A map minimum zoom.

|`maxZoom`
|`Double`
|A map maximum zoom.

|`layers`
|`List<GeoLayer>`
|Map base layers.

|`crs`
|`GeoCrs`
|A Coordinate Reference System.

|`features`
|`Map<String, Object>`
|Map features.
|===

.Common map layer (`GeoLayer`) properties
[cols="1,1,3"]
|===
|Property |Type |Description

|`name`
|`String`
|A layer name.

|`label`
|`String`
|A layer label.

|`description`
|`String`
|A layer description.

|`features`
|`Map<String, Object>`
|Layer features.
|===

.Additional tile layer (`GeoTileLayer`) properties
[cols="1,1,3"]
|===
|Property |Type |Description

|`urlTemplate`
|`String`
|A tile service URL template.

|`subdomains`
|`List<String>`
|An optional list of map server subdomains, e.g. `GeoLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").withSubdomains(["a", "b", "c"])`.

|`options`
|`Map<String, String>`
|Additional layer options.
|===

.Additional WMS layer (`GeoWmsLayer`) properties
[cols="1,1,3"]
|===
|Property |Type |Description

|`baseUrl`
|`String`
|A WMS base URL, e.g. `"https://www.gebco.net/data_and_products/gebco_web_services/north_polar_view_wms/mapserv?"`.

|`layers`
|`List<String>`
|WMS layer names.

|`crs`
|`GeoCrs`
|A Coordinate Reference System.

|`format`
|`String`
|An optional map image format, e.g. `"image/png"`.

|`version`
|`String`
|An optional WMS version, e.g. `"1.1.1"`.

|`styles`
|`List<String>`
|Optional WMS styles.

|`transparent`
|`Boolean`
|An optional transparency flag.

|`otherParameters`
|`Map<String, String>`
|Optional other WMS request parameters.
|===

.Geographical position (`GeoPosition`) properties
[cols="1,1,3"]
|===
|Property |Type |Description

|`latitude`
|`Double`
|Latitude.

|`longitude`
|`Double`
|Longitude.
|===

.Coordinate Reference System (`GeoCrs`) properties
[cols="1,1,3"]
|===
|Property |Type |Description

|`code`
|`String`
|A CRS code, e.g. `"EPSG:4326"`.

|`projection`
|`String`
|An optional projection definition string, e.g.`"+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"`. The {sponge} Flutter API library supports definitions compatible with the https://github.com/maRci002/proj4dart[Proj4dart library].

|`resolutions`
|`List<Double>`
|Optional supported resolutions, e.g. `[32768, 16384, 8192, 4096, 2048, 1024, 512, 256, 128]`.
|===

== Customized applications
Access to actions in the {appName} is generic. However you could build a customized GUI using your own Flutter code using the upcoming {sponge} Flutter API library.

=== {sponge} Digit Recognition
The {sponge} Digit Recognition mobile application is an example of using a customized Flutter UI.

NOTE: The {sponge} Digit Recognition application is currently under development and is not officially published. It will be released as an open source.

image::screens/mobile/digits_drawing.png[title="The digit recognition - drawing a digit",width=300,pdfwidth=35%,scaledwidth=35%]

The application allows drawing a digit that will be recognized by a {sponge} action. After each stroke the remote action call is made and the result is shown in the circle.

== Third party Dart/Flutter software
The {appName} and the {sponge} Flutter API library use third party software released under various open-source licenses. Besides the dependencies stated in the respective Flutter projects, the following components use modified versions of other open-source software:

* `AsyncPopupMenuButton` - a modified Flutter `PopupMenuButton` widget that adds support for an asynchronous item builder.
* `Painter` - a modified https://pub.dartlang.org/packages/painter2 library. It is used for drawings.

== Application development

=== State management
The {sponge} Flutter API library uses the MVP pattern mixed with BLoC and Provider.

